<html>
<head>
	<meta 
	name='viewport' 
	content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no'/>
	<script type="text/javascript" src="infinite-canvas.js"></script>
	<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vue?a"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.6/ace.js" type="text/javascript" charset="utf-8"></script>
	<link rel="stylesheet" type="text/css" href="index.css">
</head>
<body>
	<template id="imageLinkTemplate">
		<li><a v-bind:href="'#' + titleandindex.index">{{titleandindex.title}}</a></li>
	</template>
	<template id="diffViewerTemplate">
		<div class="diff-viewer" v-bind:class="{visible:visible}">
			<div class="header">
				<span class="close" v-on:click="$emit('close')">x</span>
			</div>
			<div>
				<canvas width="400" height="400" ref="canvas"></canvas>
			</div>
		</div>
	</template>
	<template id="exampleTemplate">
		<div class="example" v-bind:class="{danger: !imagesAreEqual}">
			<div class="example-title" v-bind:id="example.index">{{example.title}}</div>
			<div>
				<div class="column">
					<canvas width="400" height="400" ref="canvas"></canvas>
				</div>
				<div class="column">
					<canvas width="400" height="400" ref="infiniteCanvas"></canvas>
				</div>
				<div class="column">
					<div ref="code" class="code"></div>
					<input type="checkbox" v-model="rotationEnabled"/>
					<label>rotation enabled</label>
					<input type="checkbox" v-model="greedyGestureHandling"/>
					<label>greedy gesture handling</label> 
				</div>
				<span v-on:click="onViewDiff" class="view-diff-link" v-if="!imagesAreEqual">view diff</span>
			</div>
		</div>
		
	</template>
	<div id="main">
		<diff-viewer v-bind:visible="viewDiff" v-on:close="onDiffViewerClose" v-bind:imagedata="diffImageData"></diff-viewer>
		<div v-if="numberSkipped > 0" class="warning">{{numberSkipped}} examples were skipped</div>
		<div v-if="unequalImages.length > 0" class="danger">
			<div>Not all images appear to be equal. Please inspect:</div>
			<ul>
				<image-link v-for="titleAndIndex in unequalImages" v-bind:titleandindex="titleAndIndex"></image-link>
			</ul>
			
		</div>
		<span id="dark" class="darklight">dark</span>
		<span id="light" class="darklight">light</span>
		<example v-for="example in examples" v-bind:example="example" v-bind:dark="dark" v-on:imagesunequal="onImagesUnequal" v-on:viewdiff="onViewDiff"></example>
	</div>
	<script type="text/javascript">
		(function(){
			var canvasWidth = 400;
			var canvasHeight = 400;
			var compareImages = function(imageData1, imageData2){
				var newData = new Uint8ClampedArray(4 * canvasWidth * canvasHeight);
				var currentIndex = 0;
				var data1 = imageData1.data;
				var data2 = imageData2.data;
				for(var r = 0; r < canvasHeight; r++){
					for(var c = 0; c < canvasWidth; c++){
						var rDif = data2[currentIndex] - data1[currentIndex];
						var gDif = data2[currentIndex + 1] - data1[currentIndex + 1];
						var bDif = data2[currentIndex + 2] - data1[currentIndex + 2];
						var aDif = data2[currentIndex + 3] - data1[currentIndex + 3];
						var redValue = 0;
						if(rDif !== 0 || gDif !== 0 || bDif !== 0 || aDif !== 0){
							redValue = rDif * rDif + gDif * gDif + bDif * bDif + aDif * aDif;
						}
						newData[currentIndex] = redValue;
						newData[currentIndex + 1] = 0;
						newData[currentIndex + 2] = 0;
						newData[currentIndex + 3] = 255;
						currentIndex += 4;
					}
				}
				return new ImageData(newData, canvasWidth);
			};
			var functionLinePattern = "([^\\r\\n]*?)([^\\s][^\\r\\n]*)";
			function getLinesFromFunction(f){
				var functionMatch = f.toString().match(/^\s*function\s*\([^)]*\)\s*\{([\w\W]*?)\}\s*$/);
				var lines = functionMatch[1].match(new RegExp(functionLinePattern, "g"));
				var lineRegExp = new RegExp("^" + functionLinePattern + "$");
				var matchedLines = lines.map(function(l){return l.match(lineRegExp);});
				var minIndentLength = Math.min.apply(null, matchedLines.map(function(l){return l[1].length;}));
				return lines.map(function(l){return l.substring(minIndentLength);})
			}
			var examples = [
						{
							code:function(ctx){
								ctx.fillStyle = 'green';
								ctx.fillRect(20, 10, 150, 100);
							},
							title: "set style and fill a rectangle"
						},
						{
							code:function(ctx){
								ctx.strokeStyle = 'green';
								ctx.strokeRect(20, 10, 160, 100);
							},
							title: "set style and stroke a rectangle"
						},
						{
							code:function(ctx){
								ctx.fillStyle = "#f00";
								ctx.beginPath();
								ctx.moveTo(0, 0);
								ctx.lineTo(100, 0);
								ctx.lineTo(100, 100);
								ctx.lineTo(0, 100);
								ctx.lineTo(0, 0);
								ctx.fill();
								ctx.fillStyle = "#00f";
								ctx.fillRect(50, 50, 100, 100);
							},
							title: "draw a path, fill it and then fill an overlapping rect",
						},
						{
							code:function(ctx){
								ctx.beginPath();
								ctx.moveTo(0, 0);
								ctx.lineTo(50, 0);
								ctx.lineTo(50, 50);
								ctx.lineTo(0, 50);
								ctx.lineTo(0, 0);
								ctx.fillRect(150, 150, 50, 50);
								ctx.fill();
								ctx.beginPath();
								ctx.clearRect(-50, -50, 150, 150);
							},
							title: "make a path, fill a rect, fill the path, begin a new path and then clear a rect containing the first drawn path"
						},
						{
							code:function(ctx){
								ctx.fillStyle = "#f00";
								ctx.beginPath();
								ctx.moveTo(0, 0);
								ctx.lineTo(100, 0);
								ctx.lineTo(100, 100);
								ctx.lineTo(0, 100);
								ctx.lineTo(0, 0);
								ctx.fill();
								ctx.fillStyle = "#00f";
								ctx.fillRect(50, 50, 100, 100);
								ctx.fill();
							},
							title: "draw a path, fill it, change state, fill an overlapping rect and fill the path again",
						},
						{
							code:function(ctx){
								// Draw yellow background
								ctx.beginPath();
								ctx.fillStyle = '#ff6';
								ctx.fillRect(0, 0, 200, 200);

								// Draw blue triangle
								ctx.beginPath();
								ctx.fillStyle = 'blue';
								ctx.moveTo(20, 20);
								ctx.lineTo(180, 20);
								ctx.lineTo(130, 130);
								ctx.closePath();
								ctx.fill();

								// Clear part of the canvas
								ctx.clearRect(10, 10, 120, 100);
							},
							title: "clear a rectangle that overlaps the drawing"
						},
						{
							code:function(ctx){
								ctx.strokeStyle = 'green';
								ctx.strokeRect(50, 40, 80, 80);
								ctx.lineWidth = 2;
								ctx.strokeRect(20, 10, 160, 100);
								ctx.lineWidth = 4;
								ctx.strokeRect(30, 20, 100, 160);
							},
							title: "stroke rectangles with different lineWidth"
						},
						{
							code: function(ctx){
								ctx.lineWidth = 15;

								ctx.beginPath();
								ctx.moveTo(20, 20);
								ctx.lineTo(130, 130);
								ctx.rect(40, 40, 70, 70);
								ctx.stroke();
							},
							title: "build a path with line and a rect and stroke it"
						},
						{
							code:function(ctx){
								ctx.beginPath();
								ctx.setLineDash([5, 15]);
								ctx.moveTo(0, 50);
								ctx.lineTo(300, 50);
								ctx.stroke();

								// Solid line
								ctx.beginPath();
								ctx.setLineDash([]);
								ctx.moveTo(0, 100);
								ctx.lineTo(300, 100);
								ctx.stroke();
							},
							title: "set different lineDash"
						},
						{
							code:function(ctx){
								ctx.setLineDash([4, 16]);

								// Dashed line with no offset
								ctx.beginPath();
								ctx.moveTo(0, 50);
								ctx.lineTo(300, 50);
								ctx.stroke();

								// Dashed line with offset of 4
								ctx.beginPath();
								ctx.strokeStyle = 'red';
								ctx.lineDashOffset = 4;
								ctx.moveTo(0, 100);
								ctx.lineTo(300, 100);
								ctx.stroke();
							},
							title: "set different lineDashOffset"
						},
						{
							code: function(ctx){
								let offset = 0;

								function draw() {
									ctx.clearRect(0, 0, 200, 200);
									ctx.setLineDash([4, 2]);
									ctx.lineDashOffset = -offset;
									ctx.strokeRect(10, 10, 100, 100);
								}

								function march() {
									offset++;
									if (offset > 16) {
										offset = 0;
									}
									draw();
									setTimeout(march, 20);
								}

								march();
							},
							title: "drawing and clearing a rectangle many times per second"
						},
						{
							code: function(ctx){
								// First path
								ctx.beginPath();
								ctx.strokeStyle = 'blue';
								ctx.moveTo(20, 20);
								ctx.lineTo(200, 20);
								ctx.stroke();

								// Second path
								ctx.beginPath();
								ctx.strokeStyle = 'green';
								ctx.moveTo(20, 20);
								ctx.lineTo(120, 120);
								ctx.stroke();
							},
							title: "stroke two different paths with two different strokeStyle"
						},
						{
							code: function(ctx){
								// Save the default state
								ctx.save();

								ctx.fillStyle = 'green';
								ctx.fillRect(10, 10, 100, 100);

								// Restore the default state
								ctx.restore();

								ctx.fillRect(150, 40, 100, 100);
							},
							title: "saving and restoring"
						},
						{
							code: function(ctx){
								ctx.fillStyle = "#f00";
								ctx.beginPath();
								ctx.moveTo(30,30);
								ctx.lineTo(30,100);
								ctx.lineTo(100,100);
								ctx.fill();
								ctx.strokeStyle = "#00f";
								ctx.lineTo(100,30);
								ctx.stroke();
							},
							title: "build a path, fill it, add to it and stroke it"
						},
						{
							code: function(ctx){
								ctx.fillStyle = "#f00";
								ctx.fillRect(10, 10, 20, 20);
								ctx.fillStyle = "#00f";
								ctx.clearRect(20, 0, 40, 40);
								ctx.fillRect(30, 10, 10, 10);
							},
							title: "fillRect using a fillStyle that was set right before clearing a rect"
						},
						{
							code:function(ctx){
								ctx.fillStyle = '#ff6';
								ctx.fillRect(0, 0, 100, 100);
								ctx.fillStyle = "#f00";
								ctx.beginPath();
								ctx.rect(25, 25, 50, 50);
								ctx.fill();
								ctx.clearRect(10, 10, 80, 80);
								ctx.fill();
							},
							title: "build path, fill it, clear a rect and then fill the path again"
						},
						{
							code:function(ctx){
								ctx.fillStyle = '#ff6';
								ctx.fillRect(0, 0, 200, 200);
								ctx.translate(50, 50);
								ctx.clearRect(0, 0, 100, 100);
							},
							title: "translate before clearing a rect"
						},
						{
							code: function(ctx){
								ctx.beginPath();
								ctx.rect(10, 10, 100, 100);
								ctx.lineWidth = 6;
								ctx.transform(.2, 0, 0, 1, 0, 0);
								ctx.stroke();
							},
							title: "build a path, set a transform and stroke"
						},
						{
							code: function(ctx){
								ctx.beginPath();
								ctx.translate(100, 0);
								ctx.moveTo(0,0);
								ctx.translate(0, 100);
								ctx.lineTo(0,0);
								ctx.translate(-100,0);
								ctx.lineTo(0,0);
								ctx.translate(0, -100);
								ctx.lineTo(0,0);
								ctx.fill();
								ctx.clearRect(50, 0, 200, 200);
							},
							title: "build a path by translating instead of lineTo a different point. then clearRect part of it"
						},
						{
							code: function(ctx){
								ctx.translate(100, 100);
								ctx.beginPath();
								ctx.moveTo(100, 0);
								ctx.transform(0, 1, -1, 0, 0, 0);
								ctx.lineTo(100, 0);
								ctx.transform(0, 1, -1, 0, 0, 0);
								ctx.lineTo(100, 0);
								ctx.transform(0, 1, -1, 0, 0, 0);
								ctx.lineTo(100, 0);
								ctx.transform(0, 1, -1, 0, 0, 0);
								ctx.lineTo(100, 0);
								ctx.stroke();
							},
							title: "build path by transforming and lineTo the 'same' point"
						},
						{
							code: function(ctx){
								ctx.fillStyle = "#f00";
								ctx.beginPath();
								ctx.rect(0,0,50,50);
								ctx.fillRect(50,50,50,50);
								ctx.fill();
							},
							title: "build a path, fill a rect and then fill the path"
						},
						{
							code:function(ctx){
								ctx.fillStyle = "#f00";
								ctx.fillRect(0, 0, 100, 100);
								ctx.fillStyle = "#00f";
								ctx.clearRect(0, 0, 50, 50);
								ctx.fillRect(25, 25, 50, 50);
							},
							title: "fillRect using a fillStyle that was set right before clearing a rect"
						},
						{
							code: function(ctx){
								// Draw shapes
								for (let i = 0; i <= 3; i++) {
									for (let j = 0; j <= 2; j++) {
										ctx.beginPath();
										let x             = 25 + j * 50;                 // x coordinate
										let y             = 25 + i * 50;                 // y coordinate
										let radius        = 20;                          // Arc radius
										let startAngle    = 0;                           // Starting point on circle
										let endAngle      = Math.PI + (Math.PI * j) / 2; // End point on circle
										let anticlockwise = i % 2 == 1;                  // Draw anticlockwise

										ctx.arc(x, y, radius, startAngle, endAngle, anticlockwise);

										if (i > 1) {
											ctx.fill();
										} else {
											ctx.stroke();
										}
									}
								}
							},
							title: "examples of arc"
						},
						{
							code:function(ctx){
								// Tangential lines
								ctx.beginPath();
								ctx.strokeStyle = 'gray';
								ctx.moveTo(200, 20);
								ctx.lineTo(200, 130);
								ctx.lineTo(50, 20);
								ctx.stroke();

								// Arc
								ctx.beginPath();
								ctx.strokeStyle = 'black';
								ctx.lineWidth = 5;
								ctx.moveTo(200, 20);
								ctx.arcTo(200,130, 50,20, 40);
								ctx.stroke();

								// Start point
								ctx.beginPath();
								ctx.fillStyle = 'blue';
								ctx.arc(200, 20, 5, 0, 2 * Math.PI);
								ctx.fill();

								// Control points
								ctx.beginPath();
								ctx.fillStyle = 'red';
								ctx.arc(200, 130, 5, 0, 2 * Math.PI); // Control point one
								ctx.arc(50, 20, 5, 0, 2 * Math.PI);   // Control point two
								ctx.fill();
							},
							title: "example of arcTo"
						},
						{
							code:function(ctx){
								// Draw the ellipse
								ctx.beginPath();
								ctx.ellipse(100, 100, 50, 75, Math.PI / 4, 0, 2 * Math.PI);
								ctx.stroke();

								// Draw the ellipse's line of reflection
								ctx.beginPath();
								ctx.setLineDash([5, 5]);
								ctx.moveTo(0, 200);
								ctx.lineTo(200, 0);
								ctx.stroke();
							},
							title: "an ellipse and a line with a lineDash"
						},
						{
							code:function(ctx){
								ctx.fillStyle = "#f00";
								ctx.fillRect(0, 0, 100, 100);
								ctx.fillStyle = "#00f";
								ctx.beginPath();
								ctx.moveTo(50,0);
								ctx.lineTo(50,50);
								ctx.lineTo(0,50);
								ctx.lineTo(0, 0);
								ctx.closePath();
								ctx.clearRect(0, 0, 75, 75);
								ctx.fill();
							},
							title: "set a fillStyle, build a path, clear a rect and fill the path"
						},
						{
							code: function(ctx){
								ctx.translate(200, 0);
								ctx.fillRect(0, 0, 100, 100);
								ctx.clearRect(50, 0, 300, 300);
							},
							title: "translate, fill a rect and clear part of it"
						},
						{
							code: function(ctx){
								ctx.translate(200, 0);
								ctx.beginPath();
								ctx.rect(0, 0, 100, 100);
								ctx.fill();
								ctx.clearRect(50, 0, 300, 300);
							},
							title: "translate, build a rect, fill it and clear part of it"
						},
						{
							code: function(ctx){
								ctx.fillRect(0, 0, 100, 100);
								ctx.beginPath();
								ctx.translate(20, 20);
								ctx.clearRect(20, 20, 20, 20);
							},
							title: "fill, translate and clear a rect"
						},
						{
							code:function(ctx){
								ctx.lineWidth = 5;
								ctx.transform(1, .2, .8, 1, 0, 0);
								ctx.strokeRect(0, 0, 100, 100);
							},
							title: "set a transform and stroke a rect"
						},
						{
							code:function(ctx){
								for (var i = 0; i < 3; i++) {
									for (var j = 0; j < 3; j++) {
										ctx.save();
										ctx.fillStyle = 'rgb(' + (51 * i) + ', ' + (255 - 51 * i) + ', 255)';
										ctx.translate(10 + j * 50, 10 + i * 50);
										ctx.fillRect(0, 0, 25, 25);
										ctx.restore();
									}
								}
							},
							title: "save, set style and translate, fillRect, restore... repeat"
						},
						{
							code:function(ctx){
								// left rectangles, rotate from canvas origin
								ctx.save();
								// blue rect
								ctx.fillStyle = '#0095DD';
								ctx.fillRect(30, 30, 100, 100); 
								ctx.rotate((Math.PI / 180) * 25);
								// grey rect
								ctx.fillStyle = '#4D4E53';
								ctx.fillRect(30, 30, 100, 100);
								ctx.restore();

								// right rectangles, rotate from rectangle center
								// draw blue rect
								ctx.fillStyle = '#0095DD';
								ctx.fillRect(150, 30, 100, 100);  
								
								ctx.translate(200, 80); // translate to rectangle center 
														// x = x + 0.5 * width
														// y = y + 0.5 * height
								ctx.rotate((Math.PI / 180) * 25); // rotate
								ctx.translate(-200, -80); // translate back
								
								// draw grey rect
								ctx.fillStyle = '#4D4E53';
								ctx.fillRect(150, 30, 100, 100);
							},
							title: "examples of rotate"
						},
						{
							code:function(ctx){
								var sin = Math.sin(Math.PI / 6);
								var cos = Math.cos(Math.PI / 6);
								ctx.translate(100, 100);
								var c = 0;
								for (var i = 0; i <= 12; i++) {
									c = Math.floor(255 / 12 * i);
									ctx.fillStyle = 'rgb(' + c + ', ' + c + ', ' + c + ')';
									ctx.fillRect(0, 0, 100, 10);
									ctx.transform(cos, sin, -sin, cos, 0, 0);
								}
								
								ctx.setTransform(-1, 0, 0, 1, 100, 100);
								ctx.fillStyle = 'rgba(255, 128, 255, 0.5)';
								ctx.fillRect(0, 50, 100, 100);
							},
							title: "example of transform and setTransform"
						},
						{
							code:function(ctx){
								ctx.fillStyle = "#f00";
								ctx.save();
								ctx.fillStyle = "#00f";
								ctx.beginPath();
								ctx.rect(0, 0, 10, 10);
								ctx.restore();
								ctx.fillRect(10, 10, 20, 20);
								ctx.fill();
							},
							title: "restore, fillRect and fill"
						},
						{
							code:function(ctx){
								ctx.fillStyle = "#f00";
								ctx.save();
								ctx.fillStyle = "#00f";
								ctx.beginPath();
								ctx.rect(0, 0, 10, 10);
								ctx.fillRect(10, 10, 20, 20);
								ctx.restore();
								ctx.fill();
							},
							title: "fillRect, restore and fill"
						},
						{
							code:function(ctx){
								ctx.fillStyle = "#f00"
								ctx.fillRect(0, 0, 100, 100);
								ctx.beginPath();
								ctx.moveTo(10,10);
								ctx.lineTo(10,90);
								ctx.lineTo(90,90);
								ctx.lineTo(90,10);
								ctx.clip();
								ctx.fillStyle = "#0f0"
								ctx.fill();
								ctx.lineTo(70,30);
								ctx.clip();
								ctx.fillStyle = "#00f";
								ctx.fillRect(0,0,100,100);
								ctx.lineTo(50,90);
								ctx.fillStyle = "#ff0";
								ctx.fill();

							},
							title: "fill a rect, begin a path, clip, make it smaller, clip, make it smaller and fill"
						},
						{
							code:function(ctx){
								ctx.save();
								ctx.beginPath();
								ctx.rect(20, 20, 40, 40);
								ctx.clip();
								ctx.beginPath();
								ctx.arc(40, 40, 22, 0, 2 * Math.PI);
								ctx.clip();
								ctx.beginPath();
								ctx.rect(0, 0, 80, 80);
								ctx.fill();
								ctx.beginPath();
								ctx.rect(0, 0, 20, 20);
								ctx.restore();
								ctx.fill();
							},
							title: "save, clip twice, fill, make rect, restore and fill"
						},
						{
							code:function(ctx){
								ctx.save();
								ctx.translate(100, 100);
								ctx.beginPath();
								ctx.rect(0, 0, 90, 90);
								ctx.save();
								ctx.fillStyle = "#bbb"
								ctx.fillRect(0, 0, 100, 100);
								ctx.fillRect(0, 0, 100, 50);
								ctx.restore();
								ctx.stroke();
								ctx.restore();
								ctx.fillRect(0, 0, 20, 20)
							},
							title: "save, create path, fill two rects, restore and stroke"
						},
						{
							code:function(ctx){
								ctx.beginPath();
								ctx.moveTo(10, 10);
								ctx.lineTo(10, 90);
								ctx.lineTo(90, 90);
								ctx.fill();
								ctx.clearRect(0, 0, 100, 100);
								ctx.lineTo(90, 10);
								ctx.stroke();
							},
							title: "make path, fill, clearRect and stroke"
						},
						{
							code:function(ctx){
								ctx.beginPath();
								ctx.moveTo(30, 10);
								ctx.lineTo(10, 10);
								ctx.lineTo(10, 90);
								ctx.lineTo(30, 90);
								ctx.fillStyle = "#f00";
								ctx.fill();
								ctx.lineTo(90, 90);
								ctx.fillStyle = "#00f";
								ctx.fill();
								ctx.clearRect(0, 0, 40, 100);
							},
							title: "make path, fill, expand, fill, clearRect"
						},
						{
							code:function(ctx){
								var gradient = ctx.createLinearGradient(0, 0, 0, 100);
								gradient.addColorStop(0, "#f00");
								gradient.addColorStop(1, "#00f");
								ctx.fillStyle = gradient;
								ctx.fillRect(0, 0, 200, 200);
							},
							title: "fill using gradient"
						},
						{
							code:function(ctx){
								var gradient = ctx.createLinearGradient(0, 0, 0, 100);
								gradient.addColorStop(0, "#f00");
								gradient.addColorStop(1, "#00f");
								ctx.strokeStyle = gradient;
								ctx.strokeRect(0, 0, 200, 200);
							},
							title: "stroke using linear gradient"
						},
						{
							code: function(ctx){
								// Create a radial gradient
								// The inner circle is at x=110, y=90, with radius=30
								// The outer circle is at x=100, y=100, with radius=70
								var gradient = ctx.createRadialGradient(110,90,30, 100,100,70);

								// Add three color stops
								gradient.addColorStop(0, 'pink');
								gradient.addColorStop(.9, 'white');
								gradient.addColorStop(1, 'green');

								// Set the fill style and draw a rectangle
								ctx.fillStyle = gradient;
								ctx.fillRect(20, 20, 160, 160);
							},
							title: "fill using radial gradient"
						},
						{
							code:function(ctx){
								ctx.beginPath();
								ctx.rect(10, 10, 100, 100);
								ctx.rect(30, 30, 30, 30);
								ctx.fill("evenodd");
							},
							title: "fill using a fill rule"
						},
						{
							code:function(ctx){
								ctx.beginPath();
								ctx.rect(10, 10, 100, 100);
								ctx.rect(30, 30, 30, 30);
								ctx.clip("evenodd");
								ctx.beginPath();
								ctx.arc(60, 60, 50 * (2 + Math.sqrt(2)) / 3, 0, 2 * Math.PI);
								ctx.fill();
							},
							title: "clip using a fill rule"
						},
						{
							code: function(ctx){
								var width = 30;
								var height = 30;
								var centerX = 5;
								var centerY = 5;
								var radiusSq = 25;
								var array = new Uint8ClampedArray(4 * width * height);
								for(var j=0;j<height;j++){
									for(var i=0;i<width;i++){
									var dx = i - centerX;
									var dy = j - centerY;
									var index = 4 * j * width + 4 * i;
									var inside = dx * dx + dy * dy < radiusSq;
									array[index] = inside ? 255:0;
									array[index + 3] = 255;
								}
								}
								var imageData = new ImageData(array, width);
								ctx.putImageData(imageData, 20, 20);
							},
							title: "put image data"
						}
					];
			new Vue({
				el:"#main",
				data:function(){
					var exaplesToShow = examples;
					var numberSkipped = 0;
					if(exaplesToShow.find(function(e){return e.focussed;})){
						var filteredExamples = exaplesToShow.filter(function(e){return e.focussed;});
						numberSkipped = exaplesToShow.length - filteredExamples.length;
						exaplesToShow = filteredExamples;
					}
					var notExcludedExamples = exaplesToShow.filter(function(e){return !e.excluded;});
					numberSkipped += exaplesToShow.length - notExcludedExamples.length;
					exaplesToShow = notExcludedExamples;
					exaplesToShow.forEach(function(e, i){e.index = i;})
					return {
						examples:exaplesToShow,
						dark:false,
						numberSkipped: numberSkipped,
						unequalImages: [],
						viewDiff: false,
						diffImageData: undefined
					};
				},
				methods:{
					onViewDiff:function(newImageData){
						this.viewDiff = true;
						this.diffImageData = newImageData;
					},
					onDiffViewerClose: function(){
						this.viewDiff = false;
					},
					onImagesUnequal: function(titleAndIndex){
						this.unequalImages.push(titleAndIndex);
					},
					setDark:function(){
						document.body.setAttribute("class","dark");
						this.dark = true;
						var params = new URLSearchParams(window.location.search);
						if(!params.has("d")){
							window.history.replaceState(null, "", "?d=1");
						}
					},
					setLight:function(){
						document.body.setAttribute("class","");
						this.dark = false;
						window.location.search = "";
					}
				},
				mounted:function(){
					var self = this;
					document.getElementById("light").addEventListener("click", function(){
						self.setLight();
					});
					document.getElementById("dark").addEventListener("click", function(){
						self.setDark();
					});
					var searchParams = new URLSearchParams(window.location.search);
					if(searchParams.get("d") === "1"){
						this.setDark();
					}
				},
				components:{
					'example':{
						template: document.getElementById("exampleTemplate").innerHTML,
						props:{
							example: Object,
							dark: Boolean
						},
						data:function(){
							return {
								rotationEnabled: false,
								greedyGestureHandling: false,
								infiniteCanvas: undefined,
								editor: undefined,
								imagesAreEqual: false
							};
						},
						methods: {
							onViewDiff: function(){
								this.$emit("viewdiff", this.diffImageData);
							}
						},
						watch:{
							rotationEnabled:function(v){
								this.infiniteCanvas.rotationEnabled = v;
							},
							greedyGestureHandling: function(v){
								this.infiniteCanvas.greedyGestureHandling = v;
							},
							dark:function(v){
								if(v){
									this.editor.setTheme("ace/theme/monokai");
								}else{
									this.editor.setTheme("");
								}
							}
						},
						mounted:function(){
							var canvas = this.$refs.canvas;
							var regularContext = canvas.getContext("2d");
							var infCanvas = this.$refs.infiniteCanvas;
							this.infiniteCanvas = new InfiniteCanvas(infCanvas);
							this.rotationEnabled = this.infiniteCanvas.rotationEnabled;
							this.greedyGestureHandling = this.infiniteCanvas.greedyGestureHandling;
							var infiniteContext = this.infiniteCanvas.getContext();
							var code = getLinesFromFunction(this.example.code).join("\r\n");
							this.editor = ace.edit(this.$refs.code);
							this.editor.session.setMode("ace/mode/javascript");
							this.editor.setValue(code);
							this.editor.clearSelection();
							//editor.setReadOnly(true);
							//this.codeText = lines.join("<br/>");
							//console.log(this.codeText.match(/[^\s][^\r\n]*/g));
							this.example.code(regularContext);
							this.example.code(infiniteContext);
							this.infiniteCanvas.addEventListener("draw", () => {
								var dataUrlRegular = canvas.toDataURL();
								var dataUrlInfinite = infCanvas.toDataURL();
								this.imagesAreEqual = dataUrlRegular === dataUrlInfinite;
								if(!this.imagesAreEqual){
									var regularCanvasData = canvas.getContext("2d").getImageData(0, 0, canvasWidth, canvasHeight);
									var infiniteCanvasData = infCanvas.getContext("2d").getImageData(0, 0, canvasWidth, canvasHeight);
									this.diffImageData = compareImages(regularCanvasData, infiniteCanvasData);
									this.$emit("imagesunequal", {title: this.example.title, index: this.example.index});
								}
							}, {once: true});

						}
					},
					'image-link':{
						template: document.getElementById("imageLinkTemplate").innerHTML,
						props:{
							titleandindex: Object
						}
					},
					'diff-viewer': {
						template: document.getElementById("diffViewerTemplate").innerHTML,
						props:{
							visible: Boolean,
							imagedata: Object
						},
						watch:{
							imagedata:function(value){
								if(!value){
									return;
								}
								this.$refs.canvas.getContext("2d").putImageData(value, 0, 0);
							}
						}
					}
				}
			});
		})();
		
	</script>
</body>
</html>